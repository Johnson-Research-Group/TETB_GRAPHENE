Internal error: encountered unexpected error in runtime:
MethodError(f=Core.Compiler.widenconst, args=(:Broadcasted,), world=0x000000000000130b)
jl_method_error_bare at /buildworker/worker/package_linux64/build/src/gf.c:1854
jl_method_error at /buildworker/worker/package_linux64/build/src/gf.c:1872
jl_lookup_generic_ at /buildworker/worker/package_linux64/build/src/gf.c:2503 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2518
widen_all_consts! at ./compiler/typeinfer.jl:521
ir_to_codeinf! at ./compiler/optimize.jl:147 [inlined]
transform_result_for_cache at ./compiler/typeinfer.jl:359 [inlined]
cache_result! at ./compiler/typeinfer.jl:390
_typeinf at ./compiler/typeinfer.jl:273
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2250
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_edge at ./compiler/typeinfer.jl:856
abstract_call_method at ./compiler/abstractinterpretation.jl:597
abstract_call_gf_by_type at ./compiler/abstractinterpretation.jl:130
abstract_call_known at ./compiler/abstractinterpretation.jl:1633
abstract_call at ./compiler/abstractinterpretation.jl:1691
abstract_call at ./compiler/abstractinterpretation.jl:1670
abstract_eval_statement at ./compiler/abstractinterpretation.jl:1812
typeinf_local at ./compiler/abstractinterpretation.jl:2276
typeinf_nocycle at ./compiler/abstractinterpretation.jl:2372
_typeinf at ./compiler/typeinfer.jl:226
typeinf at ./compiler/typeinfer.jl:209
typeinf_ext at ./compiler/typeinfer.jl:937
typeinf_ext_toplevel at ./compiler/typeinfer.jl:970
typeinf_ext_toplevel at ./compiler/typeinfer.jl:966
jfptr_typeinf_ext_toplevel_14036.clone_1 at /global/common/software/nersc/pm-2022q3/sw/julia-2022-09-24/julia/1.8.0-beta1/lib/julia/sys.so (unknown line)
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
jl_apply at /buildworker/worker/package_linux64/build/src/julia.h:1825 [inlined]
jl_type_infer at /buildworker/worker/package_linux64/build/src/gf.c:306
jl_generate_fptr_impl at /buildworker/worker/package_linux64/build/src/jitlayers.cpp:314
jl_compile_method_internal at /buildworker/worker/package_linux64/build/src/gf.c:2056
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2332 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
gradient at /global/homes/d/dpalmer3/.julia/nersc/perlmutter/packages/ForwardDiff/pDtsf/src/gradient.jl:17
get_hellman_feynman at /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TB_Utils.jl:175
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
JULIA_get_tb_forces_energy at /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_TB.jl:139
JULIA_get_tb_forces_energy at /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_TB.jl:122
unknown function (ip: 0x7fcef40b40f4)
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
jl_apply at /buildworker/worker/package_linux64/build/src/julia.h:1825 [inlined]
jl_f__call_latest at /buildworker/worker/package_linux64/build/src/builtins.c:769
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
jl_apply at /buildworker/worker/package_linux64/build/src/julia.h:1825 [inlined]
do_apply at /buildworker/worker/package_linux64/build/src/builtins.c:725
#invokelatest#2 at ./essentials.jl:729
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
jl_apply at /buildworker/worker/package_linux64/build/src/julia.h:1825 [inlined]
do_apply at /buildworker/worker/package_linux64/build/src/builtins.c:725
invokelatest at ./essentials.jl:727
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
jl_apply at /buildworker/worker/package_linux64/build/src/julia.h:1825 [inlined]
do_apply at /buildworker/worker/package_linux64/build/src/builtins.c:725
_pyjlwrap_call at /global/homes/d/dpalmer3/.julia/nersc/perlmutter/packages/PyCall/ygXW2/src/callback.jl:28
unknown function (ip: 0x7fd8781602ac)
_jl_invoke at /buildworker/worker/package_linux64/build/src/gf.c:2340 [inlined]
ijl_apply_generic at /buildworker/worker/package_linux64/build/src/gf.c:2522
pyjlwrap_call at /global/homes/d/dpalmer3/.julia/nersc/perlmutter/packages/PyCall/ygXW2/src/callback.jl:44
unknown function (ip: 0x7fd87815c626)
_PyObject_MakeTpCall at /usr/local/src/conda/python-3.11.5/Objects/call.c:214
_PyEval_EvalFrameDefault at /usr/local/src/conda/python-3.11.5/Python/ceval.c:4774
_PyEval_EvalFrame at /usr/local/src/conda/python-3.11.5/Include/internal/pycore_ceval.h:73 [inlined]
_PyEval_Vector at /usr/local/src/conda/python-3.11.5/Python/ceval.c:6439
PyEval_EvalCode at /usr/local/src/conda/python-3.11.5/Python/ceval.c:1154
run_eval_code_obj at /usr/local/src/conda/python-3.11.5/Python/pythonrun.c:1712
run_mod at /usr/local/src/conda/python-3.11.5/Python/pythonrun.c:1733
pyrun_file at /usr/local/src/conda/python-3.11.5/Python/pythonrun.c:1628
_PyRun_SimpleFileObject at /usr/local/src/conda/python-3.11.5/Python/pythonrun.c:440
_PyRun_AnyFileObject at /usr/local/src/conda/python-3.11.5/Python/pythonrun.c:79
pymain_run_file_obj at /usr/local/src/conda/python-3.11.5/Modules/main.c:360 [inlined]
pymain_run_file at /usr/local/src/conda/python-3.11.5/Modules/main.c:379 [inlined]
pymain_run_python at /usr/local/src/conda/python-3.11.5/Modules/main.c:601 [inlined]
Py_RunMain at /usr/local/src/conda/python-3.11.5/Modules/main.c:680
Py_BytesMain at /usr/local/src/conda/python-3.11.5/Modules/main.c:734
__libc_start_main at /lib64/libc.so.6 (unknown line)
_start at /pscratch/sd/d/dpalmer3/mypythonev/bin/python (unknown line)
Traceback (most recent call last):
  File "/pscratch/sd/d/dpalmer3/TEGT_MD/tests/test_relax.py", line 193, in <module>
    tb_energy,tb_forces = calc_obj.run_tight_binding(atoms)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_calc.py", line 218, in run_tight_binding
    e,f = tb_fxn(i)
          ^^^^^^^^^
  File "/pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_calc.py", line 178, in func
    energy,force = Main.JULIA_get_tb_forces_energy(positions,atom_types,cell,kpoint,tbparams,self.device_num,self.device_type)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: <PyCall.jlwrap (in a Julia function called from Python)
JULIA: type #isa has no field args
Stacktrace:
  [1] getproperty
    @ ./Base.jl:38 [inlined]
  [2] instantiate
    @ ./broadcast.jl:281 [inlined]
  [3] materialize
    @ ./broadcast.jl:860 [inlined]
  [4] broadcast_preserving_zero_d
    @ ./broadcast.jl:849 [inlined]
  [5] -(A::Vector{Float64}, B::Vector{ForwardDiff.Dual{ForwardDiff.Tag{var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, Float64}, Float64, 3}})
    @ Base ./arraymath.jl:8
  [6] wrap_disp(r1::Vector{ForwardDiff.Dual{ForwardDiff.Tag{var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, Float64}, Float64, 3}}, r2::Vector{Float64}, cell::Matrix{Float64})
    @ Main /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_TB.jl:49
  [7] (::var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}})(r1::Vector{ForwardDiff.Dual{ForwardDiff.Tag{var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, Float64}, Float64, 3}})
    @ Main /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TB_Utils.jl:102
  [8] vector_mode_dual_eval!
    @ ~/.julia/nersc/perlmutter/packages/ForwardDiff/pDtsf/src/apiutils.jl:37 [inlined]
  [9] vector_mode_gradient(f::var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, Float64}, Float64, 3, Vector{ForwardDiff.Dual{ForwardDiff.Tag{var"#helem#2102"{Vector{Float64}, Matrix{Float64}, String, String, Dict{String, Dict{String, Dict{String, Any}}}}, Float64}, Float64, 3}}})
    @ ForwardDiff ~/.julia/nersc/perlmutter/packages/ForwardDiff/pDtsf/src/gradient.jl:106
 [10] gradient(f::Any, x::AbstractArray, cfg::ForwardDiff.GradientConfig{T}, ::Val{CHK}) where {T, CHK}
    @ ForwardDiff ~/.julia/nersc/perlmutter/packages/ForwardDiff/pDtsf/src/gradient.jl:19
 [11] gradient(f::Any, x::AbstractArray, cfg::ForwardDiff.GradientConfig{T}) where T (repeats 2 times)
    @ ForwardDiff ~/.julia/nersc/perlmutter/packages/ForwardDiff/pDtsf/src/gradient.jl:17
 [12] get_hellman_feynman(atom_positions::Matrix{Float64}, neighbor_list::Dict{Int64, Array{Int64}}, atom_types::Vector{String}, cell::Matrix{Float64}, eigvec::Matrix{ComplexF64}, kpoint::Vector{Float64}, params::Dict{String, Dict{String, Dict{String, Any}}})
    @ Main /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TB_Utils.jl:175
 [13] JULIA_get_tb_forces_energy(atom_positions::Matrix{Float64}, atom_types::Vector{String}, cell::Matrix{Float64}, kpoints::Vector{Float64}, params_str::String, device_num::Int64, device_type::String, rcut::Int64)
    @ Main /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_TB.jl:139
 [14] JULIA_get_tb_forces_energy(atom_positions::Matrix{Float64}, atom_types::Vector{String}, cell::Matrix{Float64}, kpoints::Vector{Float64}, params_str::String, device_num::Int64, device_type::String)
    @ Main /pscratch/sd/d/dpalmer3/mypythonev/lib/python3.11/site-packages/TEGT/TEGT_TB.jl:122
 [15] invokelatest(::Any, ::Any, ::Vararg{Any}; kwargs::Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}})
    @ Base ./essentials.jl:729
 [16] invokelatest(::Any, ::Any, ::Vararg{Any})
    @ Base ./essentials.jl:727
 [17] _pyjlwrap_call(f::Function, args_::Ptr{PyCall.PyObject_struct}, kw_::Ptr{PyCall.PyObject_struct})
    @ PyCall ~/.julia/nersc/perlmutter/packages/PyCall/ygXW2/src/callback.jl:28
 [18] pyjlwrap_call(self_::Ptr{PyCall.PyObject_struct}, args_::Ptr{PyCall.PyObject_struct}, kw_::Ptr{PyCall.PyObject_struct})
    @ PyCall ~/.julia/nersc/perlmutter/packages/PyCall/ygXW2/src/callback.jl:44>
srun: error: nid005823: task 0: Exited with exit code 1
srun: Terminating StepId=18094343.0
